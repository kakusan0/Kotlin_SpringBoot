# =============================================================================
# Tomcat WAR Deployment Profile
# =============================================================================
# Activate with SPRING_PROFILES_ACTIVE=war when running inside external Tomcat.
spring.config.activate.on-profile=war
# =============================================================================
# DataSource (override via environment variables on the Tomcat host)
# =============================================================================
spring.datasource.url=${APP_DB_URL:jdbc:postgresql://db-host:5432/demo_db}
spring.datasource.username=${APP_DB_USER:demo_user}
spring.datasource.password=${APP_DB_PASSWORD:demo_pass}
spring.datasource.hikari.maximum-pool-size=${APP_DB_MAX_POOL:20}
spring.datasource.hikari.minimum-idle=${APP_DB_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${APP_DB_CONN_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${APP_DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${APP_DB_MAX_LIFETIME:1800000}
# =============================================================================
# Flyway
# =============================================================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.out-of-order=false
# =============================================================================
# Servlet container settings (context path defined by Tomcat deployment)
# =============================================================================
server.servlet.context-path=${APP_CONTEXT_PATH:/demo}
server.servlet.session.cookie.secure=true
server.servlet.session.timeout=10m
# =============================================================================
# Logging
# =============================================================================
logging.level.root=WARN
logging.level.com.example.demo=INFO
logging.file.name=${LOG_DIR:/var/log/app}/application.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30
# =============================================================================
# Redis-backed HTTP session (optional, override in environment if not used)
# =============================================================================
spring.session.store-type=${APP_SESSION_STORE:redis}
spring.data.redis.host=${APP_REDIS_HOST:redis-host}
spring.data.redis.port=${APP_REDIS_PORT:6379}
spring.session.redis.namespace=${APP_SESSION_NAMESPACE:app:sessions}
# =============================================================================
# Application-specific settings
# =============================================================================
app.trust-proxy=true
app.login.rate-limit.capacity=${APP_LOGIN_RATE_CAP:5}
app.login.rate-limit.refill-minutes=${APP_LOGIN_RATE_REFILL:5}

