<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: commonHead('管理画面')}">
    <title>管理画面</title>
</head>

<body>
<!-- 固定ヘッダー（簡易コピー） -->
<header class="header">
    <div class="d-flex align-items-center h-100 px-3 px-md-5 position-relative">
        <div>
            <button aria-controls="sidebarMenu" aria-label="メニューを開く" class="btn btn-primary d-md-none border-0"
                    data-bs-target="#sidebarMenu" data-bs-toggle="offcanvas" type="button">
                <i class="bi bi-list"></i>
            </button>
            <button aria-label="サイドバーを開閉" class="btn btn-primary d-none d-md-block border-0"
                    id="pcSidebarToggle"
                    type="button">
                <i class="bi bi-list"></i>
            </button>
        </div>
        <div class="position-absolute top-50 start-50 translate-middle d-flex align-items-center">
            <strong>管理</strong>
        </div>
        <div class="position-absolute top-50 end-0 translate-middle-y pe-3">
            <form action="/logout" class="m-0" method="post" th:action="@{/logout}">
                <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                <button class="btn btn-outline-danger btn-sm" type="submit">
                    <i class="bi bi-box-arrow-right"></i>
                    <span class="d-none d-md-inline ms-1">ログアウト</span>
                </button>
            </form>
        </div>
    </div>
</header>

<!-- サイドバー（共通フラグメント） -->
<div th:replace="~{fragments/sidebar :: adminSidebar}"></div>

<main class="main-content p-4">
    <div class="container-fluid">
        <h2>メニュー／画面管理</h2>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-3" id="manageTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button aria-controls="menus" aria-selected="false" class="nav-link" data-bs-target="#menus"
                        data-bs-toggle="tab"
                        id="menus-tab" role="tab" type="button">メニュー管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button aria-controls="screens" aria-selected="true" class="nav-link active" data-bs-target="#screens"
                        data-bs-toggle="tab"
                        id="screens-tab" role="tab" type="button">画面管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button aria-controls="paths" aria-selected="false" class="nav-link" data-bs-target="#paths"
                        data-bs-toggle="tab"
                        id="paths-tab" role="tab" type="button">パス管理
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- Menu 管理タブ -->
            <div aria-labelledby="menus-tab" class="tab-pane fade" id="menus" role="tabpanel">
                <div class="mb-3">
                    <button class="btn btn-primary" id="addMenuBtn">メニューを追加</button>
                </div>
                <div id="menuArea">
                    <table class="table table-striped" id="menuTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>メニュー名</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- フォールバック: サーバーサイド描画（JSがまだ走っていない/失敗時に表示） -->
                        <tr th:each="m : ${menus}">
                            <td th:text="${m.id}">1</td>
                            <td th:text="${m.name}">Menu</td>
                            <td><span class="text-muted">読み込み後に置き換え</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Screen 管理タブ -->
            <div aria-labelledby="screens-tab" class="tab-pane fade show active" id="screens" role="tabpanel">
                <div class="mb-3">
                    <button class="btn btn-primary" id="addScreenBtn">画面を追加</button>
                </div>
                <div id="manageArea">
                    <table class="table table-striped" id="manageTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>メニュー名</th>
                            <th>画面名</th>
                            <th>パス名</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- フォールバック: サーバーサイド描画（JSがまだ走っていない/失敗時に表示） -->
                        <tr th:each="s : ${screens}">
                            <td th:text="${s.id}">1</td>
                            <td th:text="${s.menuName}"></td>
                            <td th:text="${s.itemName}"></td>
                            <td th:text="${s.pathName}"></td>
                            <td><span class="text-muted">読み込み後に置き換え</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Path 管理タブ -->
            <div aria-labelledby="paths-tab" class="tab-pane fade" id="paths" role="tabpanel">
                <div class="mb-3">
                    <button class="btn btn-primary" id="addPathBtn">パスを追加</button>
                </div>
                <div id="pathArea">
                    <table class="table table-striped" id="pathTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>パス名</th>
                            <th>状態</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- rows populated by manage.js -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 画面下部中央の通知エリア -->
<div class="position-fixed bottom-0 start-50 translate-middle-x mb-3" id="notificationArea" style="z-index: 1050;">
    <!-- 通知トースト -->
    <div aria-atomic="true" aria-live="assertive" class="toast align-items-center text-white border-0"
         id="updateNotification"
         role="alert" style="display: none;">
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="bi me-2" id="notificationIcon"></i>
                <span id="notificationMessage"></span>
            </div>
            <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    type="button"></button>
        </div>
    </div>
</div>

<script defer th:src="@{/js/manage.js}"></script>
</body>

</html>
