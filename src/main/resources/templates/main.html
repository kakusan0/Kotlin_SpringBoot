<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: commonHead(${currentScreen ?: 'メインページ'})}">
  <!-- Static fallback title to satisfy template validators; runtime fragment will replace head content -->
  <title th:text="${currentScreen ?: 'メインページ'}">アプリケーション</title>
</head>

<body>

  <!-- 固定ヘッダー -->
  <header class="header">
    <div class="d-flex align-items-center h-100 px-3 px-md-5 position-relative">
      <div>
        <button aria-controls="sidebarMenu" aria-label="メニューを開く" class="btn btn-primary d-md-none border-0"
          data-bs-target="#sidebarMenu" data-bs-toggle="offcanvas" type="button">
          <i class="bi bi-list"></i>
        </button>
        <button class="btn btn-primary d-none d-md-block border-0" id="pcSidebarToggle" aria-label="サイドバーを開閉"
          type="button">
          <i class="bi bi-list"></i>
        </button>
      </div>
      <div class="position-absolute top-50 start-50 translate-middle d-flex align-items-center">
        <button class="btn btn-secondary" data-bs-target="#scrollableModal" data-bs-toggle="modal" id="itemSelectButton"
          type="button">
          <span id="selectedItemName" th:text="${selectedScreenName ?: '画面を選択'}"></span>
        </button>
      </div>
    </div>
  </header>

  <!-- サイドバー（モバイルではオフキャンバス） -->
  <div aria-labelledby="sidebarMenuLabel" class="offcanvas offcanvas-start offcanvas-md is-collapsed" id="sidebarMenu"
    tabindex="-1">
    <div class="offcanvas-body p-0">
      <ul class="nav flex-column">
        <!-- サーバー側で渡された visibleMenus を表示（Homeでは画面に割り当てられているメニューのみ） -->
        <li th:each="m : ${visibleMenus}" class="nav-item">
          <a class="nav-link text-dark content-item" href="#" th:attr="data-screen-name=${m.name}">
            <i class="bi bi-folder"></i>
            <span th:text="${m.name}">Menu</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link text-dark" href="/manage">
            <i class="bi bi-tools"></i>
            <span>管理</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- メインコンテンツ（currentScreen に応じて切替） -->
  <main class="main-content p-4 is-collapsed">
    <div class="container-fluid">
      <div th:if="${errorMessage != null and errorMessage != ''}" class="mb-3">
        <div class="alert alert-danger" th:text="${errorMessage}"></div>
      </div>
      <div th:if="${currentScreenPath != null and currentScreenPath != ''}">
        <div th:replace="~{${'fragments/' + currentScreenPath} :: content}"></div>
      </div>
      <div th:unless="${errorMessage != null and errorMessage != ''}">
        <p>メニュー選択ボタンから選択してください。</p>
      </div>
    </div>
  </main>

  <!-- モーダル -->
  <div th:replace="~{fragments/modals/errorModal :: content}"></div>
  <div th:replace="~{fragments/modals/contentModal :: content}"></div>


</body>

</html>